================================================================================
                        WKPC META AUTOMATION PROJECT JOURNAL
================================================================================
Project: Meta Lead Ads Automation System
Stack:   MERN (MongoDB, Express.js, React, Node.js) + Socket.IO + TailwindCSS
Author:  Antigravity (AI Assistant) & User
Date:    December 2025

--------------------------------------------------------------------------------
1. INTRODUCTION & PROJECT GOAL
--------------------------------------------------------------------------------
The "WKPC Meta Automation" project is a CRM (Customer Relationship Management) 
system designed to automate the handling of leads generated via Meta (Facebook) 
Lead Ads. 

The Core Problem:
Manually downloading leads from Facebook and emailing them is slow.
Speed to lead is critical.

The Solution:
A real-time system that:
1. Receives leads instantly via Webhooks (simulated for dev).
2. Automatically sends a Welcome Email (SendGrid/Nodemailer).
3. Automatically triggers a WhatsApp message (Business API).
4. Distributes leads to a Sales Team via a dashboard.

--------------------------------------------------------------------------------
2. TECHNICAL ARCHITECTURE (DEEP DIVE)
--------------------------------------------------------------------------------
The project is split into two distinct applications running concurrently:

A. SERVER (Backend - Port 4000)
   - Built on Node.js & Express.
   - Acts as the central brain.
   - Connects to MongoDB Atlas (Cloud Database).
   - Handles external APIs (SendGrid, Meta Graph API).
   - Uses Socket.IO to push real-time updates to the frontend (no page reloads).

B. CLIENT (Frontend - Port 3000/5173)
   - Built with React (Vite).
   - Styled with TailwindCSS for a modern, responsive UI.
   - Uses Axios for API calls and Socket.IO-Client for live data.

--------------------------------------------------------------------------------
3. DATABASE SCHEMA (MONGODB)
--------------------------------------------------------------------------------
We designed three core models to handle the data:

1. LEAD Model (models/Lead.js):
   - Stores user data: Name, Email, Phone, Form ID.
   - Tracks Status: 'New' -> 'Contacted' -> 'Interested' -> 'Converted'/'Lost'.
   - Tracks Automation: `emailStatus` ('sent'/'failed'), `whatsappStatus`.
   - RBAC: `assignedTo` field links a lead to a specific Sales User.

2. USER Model (models/Admin.js & User.js):
   - Roles: 'admin' (can see all, delete, export) vs 'sales' (can only see assigned).
   - Security: Passwords hashed with `bcryptjs`.

3. LOG Model (models/Log.js):
   - An audit trail for every automation attempt.
   - Records success/failure messages for debugging (e.g., "SendGrid 403 Forbidden").

--------------------------------------------------------------------------------
4. KEY FEATURES IMPLEMENTATION LOG
--------------------------------------------------------------------------------

[PHASE 1: AUTOMATION SERVICES]
We implemented a robust email service (`emailService.js`) with a "Mock Mode".
- Logic: If real API keys are missing, we don't crash. We log the email 
  content to the console.
- Benefit: Allows development without spending money on email credits.
- Fallback: Tries SendGrid first; if it fails, falls back to Nodemailer (SMTP).
- WhatsApp: Template-based messaging logic ready for Meta Business API.

[PHASE 2: REAL-TIME DASHBOARD]
- Problem: Users shouldn't hit "Refresh" to see new leads.
- Solution: Socket.IO integration.
- Flow: 
  Webhook -> Server saves Lead -> Server emits 'new_lead' event -> 
  Frontend listener catches event -> Updates State (`setLeads`).

[PHASE 3: ADMIN SUPERPOWERS]
We focused heavily on the Admin Dashboard (`Dashboard.jsx`):
1. **RBAC (Role-Based Access Control)**:
   - Admins see the "Manage Team" button and all leads.
   - Sales users only see leads where `lead.assignedTo == user._id`.

2. **Wait-Free Filtering**:
   - Implemented server-side filtering logic (`leadController.js`).
   - Frontend dropdown filters by New, Lost, Converted, etc.

3. **Bulk Actions (The Power Tools)**:
   - **Bulk Delete**: A custom API endpoint (`POST /delete-batch`) that takes an 
     array of IDs and deletes them + their logs in one transaction.
   - **Export to Excel**: A pure frontend implementation that converts the 
     visible JSON data into a CSV Blob and triggers a browser download.

--------------------------------------------------------------------------------
5. SECURITY & STABILITY MEASURES
--------------------------------------------------------------------------------
We encountered specific challenges and solved them:

1. **The "Port 4000 In Use" Error**:
   - Issue: Restarting the server often left "zombie" processes holding the port.
   - Fix: Modified `package.json` scripts to run `npx kill-port 4000` 
     automatically before starting.

2. **Email Sender verification**:
   - Issue: SendGrid blocked emails with 403 Forbidden.
   - Discovery: The "From" address must be verified in SendGrid.
   - Fix: Guided verification of `slokender05@gmail.com`.

3. **Responsive Design**:
   - We used Tailwind's `md:` and `sm:` prefixes to ensure the complex 
     tables and headers stack vertically on mobile telephones, making the 
     app usable on the go.

--------------------------------------------------------------------------------
6. FUTURE ROADMAP
--------------------------------------------------------------------------------
1. Connect real Facebook Webhooks (requires HTTPS/Ngrok).
2. Analytics Charts (Leads over time graph).
3. AI Integration (Auto-reply to leads based on intent).

================================================================================
                        END OF JOURNAL
================================================================================
